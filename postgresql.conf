# PostgreSQL configuration for high connection count
# Based on PostgreSQL 15

# Connection Settings
max_connections = 1000                  # Maximum number of concurrent connections
listen_addresses = '*'                  # Listen on all addresses
port = 5432                            # PostgreSQL port

# Memory Settings
shared_buffers = 256MB                 # Shared memory buffer pool
effective_cache_size = 1GB             # Planner's assumption about effective disk cache
work_mem = 4MB                         # Memory for query operations
maintenance_work_mem = 64MB            # Memory for maintenance operations

# Connection Pool Settings
max_wal_size = 1GB                     # Maximum WAL size
min_wal_size = 80MB                    # Minimum WAL size
checkpoint_completion_target = 0.7     # Checkpoint completion target

# Logging Settings
log_destination = 'stderr'             # Log to stderr
logging_collector = off                # Don't collect logs to files in container
log_min_messages = warning             # Only log warnings and errors
log_statement = 'none'                 # Don't log statements (reduces overhead)

# Performance Settings
random_page_cost = 1.1                 # Cost of random page access
effective_io_concurrency = 200         # Concurrent I/O operations

# Autovacuum Settings (important for high connection workloads)
autovacuum = on                        # Enable autovacuum
autovacuum_max_workers = 3             # Number of autovacuum workers
autovacuum_naptime = 1min              # Time between autovacuum runs

# Lock Settings
max_locks_per_transaction = 64         # Maximum locks per transaction
max_pred_locks_per_transaction = 64    # Maximum predicate locks per transaction

# Background Writer Settings
bgwriter_delay = 200ms                 # Background writer delay
bgwriter_lru_maxpages = 100           # Maximum pages written by background writer
bgwriter_lru_multiplier = 2.0         # Multiplier for LRU scan

# WAL Settings
wal_buffers = 16MB                     # WAL buffer size
commit_delay = 0                       # Commit delay
commit_siblings = 5                    # Commit siblings threshold
